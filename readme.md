
# SSH
ssh-keygen На локальной машине генерируем ssh ключи находясь в домашней директории, везде enter  
cat id_rsa.pub Выводим публичный ключ и копируем его на любую машину или сервис куда хотим подключиться по ssh  
Для облаков часто нужно чтобы права на частный ключ были выданы 400, т.е. права только на чтение 
  
для пользователя владельца и все. Файл принимает такой вид:  
-r--------  1 alex alex 2590 авг 16 13:11 id_rsa  
  
Очистка отпечатка ключа известного хоста - удаляем запись о нужном хосте к которому не можем подключиться. Т.е когда возникает ошибка вида
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @  
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
выполняем тогда команду:  
ssh-keygen -f "/home/alex/.ssh/known_hosts" -R "91.219.227.102"  

если хотим выйти то пишем exit  
если хотим выключить удаленную машину то sudo poweroff  

``` bash
# Добавляем пользователя с именем 'user' и назначаем пароль 'password'
useradd -rm -d /home/user -s /bin/bash -G sudo -u 1001 user
echo 'user:mypass123' | chpasswd
# Создает нового пользователя с именем user.
# Назначает UID (идентификатор пользователя) 1001 этому пользователю.
# Создает домашний каталог /home/user для нового пользователя.
# Устанавливает Bash (/bin/bash) как оболочку по умолчанию.
# Добавляет пользователя в группу sudo, предоставляя ему права суперпользователя.

# Настраиваем SSH для входа под пользователем root
echo 'PermitRootLogin yes' >> /etc/ssh/sshd_config
echo 'PasswordAuthentication yes' >> /etc/ssh/sshd_config
echo 'PermitEmptyPasswords no' >> /etc/ssh/sshd_config
echo 'ChallengeResponseAuthentication no' >> /etc/ssh/sshd_config
echo 'UsePAM yes' >> /etc/ssh/sshd_config
```
или с помощью команды adduser  
Команда `adduser` — это более высокоуровневая утилита, чем `useradd`, и она предоставляет удобный интерфейс для создания нового пользователя с настройками по умолчанию. Команда `adduser` является более интерактивной и автоматически создает домашний каталог, копирует нужные файлы в этот каталог и выполняет другие действия по настройке.

Для выполнения тех же действий, что и в вашей команде `useradd`, с помощью команды `adduser`, команда будет выглядеть так:

```bash
sudo adduser --uid 1001 --home /home/user --shell /bin/bash --ingroup sudo user
```

1. **`sudo`**: Используем `sudo` для выполнения команды с правами суперпользователя, так как создание новых пользователей требует административных привилегий.

2. **`adduser`**: Команда для добавления нового пользователя.

3. **`--uid 1001`**: Указывает, что создаваемому пользователю нужно задать идентификатор пользователя (UID) 1001.

4. **`--home /home/user`**: Устанавливает домашний каталог для нового пользователя в `/home/user`.

5. **`--shell /bin/bash`**: Указывает оболочку по умолчанию для нового пользователя, в данном случае Bash.

6. **`--ingroup sudo`**: Задает основную группу для нового пользователя. Здесь это группа `sudo`, что дает пользователю права выполнять команды с повышенными привилегиями с помощью `sudo`.

7. **`user`**: Имя пользователя, которое будет создано.

### Описание команды

Эта команда `adduser` выполняет все те же действия, что и ваша команда `useradd`:

- Создает нового пользователя с именем `user`.
- Назначает пользователю UID 1001.
- Создает домашний каталог `/home/user`.
- Устанавливает оболочку Bash (`/bin/bash`).
- Добавляет пользователя в основную группу `sudo`.

Команда `adduser` автоматически создает домашний каталог, копирует необходимые файлы, такие как `.bashrc`, и правильно настраивает их. Она также выполняет дополнительные проверки, такие как проверка на существование UID и группы, что делает ее более безопасной и удобной для использования.

## Копирование по ssh

Чтобы скопировать файлы и папки на удаленный сервер через SSH, можно использовать команду `scp`. Вот основные примеры её использования:

1. **Копирование одного файла на удалённый сервер:**

   ```bash
   scp /путь/к/локальному/файлу username@remote_host:/путь/к/удаленному/каталогу/
   ```

   - `/путь/к/локальному/файлу` — путь к файлу на вашем локальном компьютере.
   - `username` — ваш логин на удаленном сервере.
   - `remote_host` — IP-адрес или доменное имя удаленного сервера.
   - `/путь/к/удаленному/каталогу/` — путь на удаленном сервере, куда вы хотите скопировать файл.

2. **Копирование директории на удалённый сервер (с использованием флага `-r` для рекурсивного копирования):**

   ```bash
   scp -r /путь/к/локальной/директории username@remote_host:/путь/к/удаленному/каталогу/
   ```
к примеру scp -r /home/alex/octobercms/storage alex@192.168.0.162:/home/alex/sambia

3. **Копирование файла с удаленного сервера на локальный компьютер:**

   ```bash
   scp username@remote_host:/путь/к/удаленному/файлу /путь/к/локальному/каталогу/
   ```

4. **Копирование директории с удаленного сервера на локальный компьютер (с использованием флага `-r`):**

   ```bash
   scp -r username@remote_host:/путь/к/удаленному/каталогу /путь/к/локальному/каталогу/
   ```

Для выполнения этих команд вам понадобится пароль для удаленного сервера или настроенный SSH-ключ для аутентификации без пароля.


# Пути, логи, конфигурации

Добавление репозитория вручную. Например, когда не получается добавить gpg ключ  
sudo nano /etc/apt/sources.list

## Nginx
 /var/www/html/index.html


# Установки приложений

https://hashicorp-releases.mcs.mail.ru/ релизы программ


## Установка бинарных приложений на примере Minikube и Terraform и packer

### Minikube  
curl -Lo minikube https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64 \
  && chmod +x minikube  
sudo mkdir -p /usr/local/bin/  
sudo install minikube /usr/local/bin/  

### Terraform  
Берем с зеркала вк https://hashicorp-releases.mcs.mail.ru/
Копируем бинарник домашнюю директорию /home/alex  
Даем права на выполнение chmod +x terraform  
Устанавливаем sudo install terraform /usr/local/bin/  

### Packer Установка
+ скачиваем packer
 https://developer.hashicorp.com/packer/install?product_intent=packer
 https://hashicorp-releases.mcs.mail.ru/packer/

```bash
sudo chmod +x packer
sudo mv packer /usr/local/bin/
packer -autocomplete-install устанавливаем автокомплит
```
  
  
# Разное

## Замена раскладки на alt shift
gsettings set org.gnome.desktop.wm.keybindings switch-input-source "['<Shift>Alt_L']"  
gsettings set org.gnome.desktop.wm.keybindings switch-input-source-backward "['<Alt>Shift_L']"  
  
## переименовать хост  
sudo vim /etc/hostname 	задаем в этом файле имя, например alexcomp  

# Alias алиасы
Добавляем в файл .bashrc в домашней директории
```bash
alias pro="cd D/YANDEXDISK/1DEVOPS/alex-info"
alias lsa="ls -la"
alias t="terraform"
alias k="kubectl"
alias duh="du -h --max-depth=1"
```

# Файлы 
## Переименование и перемещение файлов и папок
Переместить или переименовать файл  
```bash
$ mv опции файл-источник файл-приемник  
mv file1 directory1 	скопировать file1 в директорию directory1  
mv file1 ./directory1 	тоже самое  
```


```bash
du -ah --max-depth=1
```
- `-a` (all) — показывает размеры всех файлов и директорий.
- `-h` (human-readable) — выводит в удобочитаемом формате.
- `--max-depth=1` — ограничивает глубину просмотра, показывая только объекты текущего уровня.

с обратной сортировкой

```bash
du -ah --max-depth=1 | sort -hr
```

Эта команда покажет размеры как папок, так и отдельных файлов в текущей директории.


## Копирование
Копирование файла в другой файл с указанным именем:  

cp опции /путь/к/файлу/источнику /путь/к/файлу/назначения  

Полное копирование, пример
```bash
sudo cp -a /tmp/wordpress/. /var/www/wordpress
```

## УДАЛЕНИЕ
Для удаления директорий, вместе с файлами и поддиректориями используется опция -R, например:
 rm -Rf /home/user/dir
 sudo rm -Rf *
 

# РАБОТА С ДИСКОМ

sudo fdisk -l 	список всех дисков

## МОНТИРОВАНИЕ ПРИ ЗАГРУЗКЕ ОС
 vi /etc/fstab
 Пример: /dev/sda1     /db     xfs     defaults     0 0
+ /dev/sda1 — диск, который мы монтируем
+ /db — каталог, в который монтируем диск
+ xfs — файловая система
+ defaults — стандартные опции. Полный их перечень можно посмотреть на Википеции.
+ 0 0 — первый отключает создание резервных копий при помощи утилиты dump, второй отключает проверку диска.

Монтируем свой диск D - добавляем строку в файл и потом создаем папку для монтирования
/dev/nvme0n1p5  /home/alex/D ntfs3 defaults 0 0 


## Создаем таблицу и раздел

sudo fdisk /dev/sda выбираем для интерактивного взаимодействия нужный диск
	g создаем таблицу GPT
	n создаем новый разделам
	w записываем изменения на диск

## Форматируем
sudo mkfs.ntfs -f  -L AlexDisk /dev/sda1 форматируем раздел в ntfs в быстром режиме

sudo mkfs -t ext4  -f -L AlexDisk /dev/sda1 	или форматируем в ext4 в быстром режиме

## Монтируем
mkdir /home/alex/flash
sudo mount /dev/sda1 /home/alex/flash/


# ПАКЕТЫ
dpkg -l 						просмотреть все пакеты установленные в системе  
dpkg -s имяпакета 				инфа о пакете, зависимостях  
dpkg -L имяпакета 				файлы пакета  

apt remove –purge имяпакета удаление пакета со всеми настройками  
sudo apt remove --purge virtualbox virtualbox-*  
После удаления можно также очистить ненужные зависимости и остаточные конфигурационные файлы:
sudo apt autoremove --purge

apt remove имяпакета 		удаление пакетов без удаления настроек  
apt policy имяпакета 		посмотреть какие версии пакета есть в репозитории  
apt install имяпакета=2.0 	установка пакета нужной версии  
apt search 	подстрока_пакета	поиск совпадений среди пакетов	


# ПОИСК

find ~/Downloads -type f -mtime +35 -delete		поиск файлов старше 35 дней и удаление
find / -name “myhelp.txt”
find гдеищем -name “чтоищем”
поиск файлов по имени
find /var/log -type d такая команда даст нам все поддиректории директории /var/log 
find /var/log -type f покажет нам все файлы

# CRON
crontab -l		просмотреть задачи текущего пользователя
crontab -e  	редактирование задач текущего пользователя
минута час день месяц день_недели /путь/к/исполняемому/файлу
 обязательно enter

# АРХИВАЦИЯ

## 7z
7z или zip
7z x файл.zip -o /tmp/ или .7z  распаковать в папку
7z x файл.zip или .7z 			распаковать в текущую папку
7z l файл.7z или .zip 			просмотр архива 
7z a Tutorial.7z tutorial/ 		Добавить в архив

## zip
unzip file1.zip					распаковать архив в текущую директорию
unzip -l zipped_file.zip 		просмотреть файлы архива без распаковки
zip output_file.zip input_file	зархивировать 1 файл
zip -r output.zip input_folder	запаковать папку

## tar

Запаковать
tar -czvf site_backup.tar.gz public_html
+ -c — создание архива.
+ -z — сжатие архива с помощью gzip.
+ -v — вывод информации о процессе архивирования.
+ -f — имя создаваемого файла.
+ . — указывает, что нужно архивировать все файлы из текущей директории.

распаковать
tar -xzvf site_backup.tar.gz -C /path/to/destination/
+ -x — извлечь файлы из архива.
+ -z — использовать gzip для распаковки (так как файл сжат с использованием gzip).
+ -v — выводить информацию о процессе распаковки (опционально).
+ -f — указывает файл архива.


# ПРОЦЕССЫ
ps -auxf

ВЫВОД
cat file1 file2  			выведет содержимое 2ух файлов 
cat file1 file2 > file3 	перезапишет file3 объединенным содержимым file1 file2
cat file1 file2 >> file3 	дополнит file3 объединенным содержимым file1 file2

du -sh * 	размеры файлов и папок в текущей директории
free -h 	свободная  оперативная память
df -h 		занятое место на дисках
sudo lsblk	инфа о разделах на диске

# ПРАВА ГРУППЫ ПОЛЬЗОВАТЕЛИ

## chmod
groups			список групп в которых состоит текущий пользователь  
chmod +x myfile  						добавляет права на выполнение для пользователя, группы и остальных  
chmod u=rwx,g=rx,o=r /home/user/dir1	присваивает определенные права  
chmod u=rwx,g=rx,o=r dir1 				тут присваиваем нужные права для пользователя, группы и остальных
  
## chown
chown пользователь опции /путь/к/файлу  
sudo chown alex:alex terraform			сменить пользователя и группу для файла или папки  
sudo chown -R alex:alex terraform			сменить пользователя и группу для файла или папки рекурсивно
sudo chown -R alex:alex \!DEVOPS\ VIDEO/ 	где значек \  это экранирование символа

## adduser
Команда `adduser` — это более высокоуровневая утилита, чем `useradd`, и она предоставляет удобный интерфейс для создания нового пользователя с настройками по умолчанию. Команда `adduser` является более интерактивной и автоматически создает домашний каталог, копирует нужные файлы в этот каталог и выполняет другие действия по настройке.

Для выполнения тех же действий, что и в вашей команде `useradd`, с помощью команды `adduser`, команда будет выглядеть так:

```bash
sudo adduser --uid 1001 --home /home/user --shell /bin/bash --ingroup sudo user
```

### Разбор параметров команды `adduser`

1. **`sudo`**: Используем `sudo` для выполнения команды с правами суперпользователя, так как создание новых пользователей требует административных привилегий.

2. **`adduser`**: Команда для добавления нового пользователя.

3. **`--uid 1001`**: Указывает, что создаваемому пользователю нужно задать идентификатор пользователя (UID) 1001.

4. **`--home /home/user`**: Устанавливает домашний каталог для нового пользователя в `/home/user`.

5. **`--shell /bin/bash`**: Указывает оболочку по умолчанию для нового пользователя, в данном случае Bash.

6. **`--ingroup sudo`**: Задает основную группу для нового пользователя. Здесь это группа `sudo`, что дает пользователю права выполнять команды с повышенными привилегиями с помощью `sudo`.

7. **`user`**: Имя пользователя, которое будет создано.


### Описание команды

Эта команда `adduser` выполняет все те же действия, что и ваша команда `useradd`:

- Создает нового пользователя с именем `user`.
- Назначает пользователю UID 1001.
- Создает домашний каталог `/home/user`.
- Устанавливает оболочку Bash (`/bin/bash`).
- Добавляет пользователя в основную группу `sudo`.

Команда `adduser` автоматически создает домашний каталог, копирует необходимые файлы, такие как `.bashrc`, и правильно настраивает их. Она также выполняет дополнительные проверки, такие как проверка на существование UID и группы, что делает ее более безопасной и удобной для использования.



# TERRAFORM

terraform validate && terraform plan 	проверка все конфигурационных файлов tf
terraform apply 						применение всех файлов и создание ресурсов в облаке
terraform destroy						удаление всех ресурсов из облака

