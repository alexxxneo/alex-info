
# Создаем внутреннюю сеть для кубера в проксмокс. Create linux bridge. vmbr1

Для развертывания кластера Kubernetes в Proxmox VE 8.2, необходимо правильно настроить сети для обеспечения связи между узлами и внешним миром. В Proxmox это можно сделать через интерфейс веб-управления или вручную с помощью редактирования конфигурационных файлов. Рассмотрим общие шаги:

### 1. Настройка сетей в Proxmox VE
#### В Proxmox VE сети обычно создаются через `bridge`-интерфейсы. Чтобы развернуть кластер Kubernetes, нужно настроить сеть таким образом, чтобы все виртуальные машины (VM) или контейнеры (LXC) могли взаимодействовать между собой и выходить в интернет.

#### Основные шаги:

#### 1.1. Создание моста (Bridge) для внутренней сети
1. Откройте веб-интерфейс Proxmox.
2. Перейдите в раздел **Datacenter > Node > Network**.
3. Нажмите кнопку **Create > Linux Bridge**.
4. Укажите имя моста, например `vmbr1` (по умолчанию первый мост может быть `vmbr0` — используется для внешнего подключения).
5. Если сеть будет только для внутренней связи между узлами кластера, оставьте поле **Bridge Ports** пустым.
6. Примените изменения.

#### 1.2. Настройка внешней сети (Интернет)
Для доступа узлов к внешней сети, вам нужно настроить bridge с внешним интерфейсом:
1. Используйте уже существующий мост `vmbr0` или создайте новый с указанием в поле **Bridge Ports** физического интерфейса, подключенного к внешней сети, например `enp0s3`.
2. Убедитесь, что для этого моста настроен NAT или имеется выход в интернет через маршрутизатор.

#### Пример конфигурации сетей в `/etc/network/interfaces`:

```bash
auto lo
iface lo inet loopback

auto enp0s3
iface enp0s3 inet manual

auto vmbr0
iface vmbr0 inet static
    address 192.168.1.100/24
    gateway 192.168.1.1
    bridge_ports enp0s3
    bridge_stp off
    bridge_fd 0

auto vmbr1
iface vmbr1 inet static
    address 10.0.0.1/24
    bridge_ports none
    bridge_stp off
    bridge_fd 0
```

- `vmbr0` — внешняя сеть (интернет).
- `vmbr1` — внутренняя сеть для Kubernetes.

### 2. Создание виртуальных машин или контейнеров для Kubernetes
1. Создайте несколько виртуальных машин (VM) или контейнеров (LXC) в Proxmox.
2. Назначьте каждой машине IP-адрес из подсети, связанной с мостом `vmbr1`.
   - Например, для трех узлов кластера Kubernetes можно использовать адреса: `10.0.0.2`, `10.0.0.3`, `10.0.0.4`.

### 3. Настройка статических маршрутов и IP-адресов (опционально)
Для стабильной работы кластера лучше использовать статические IP-адреса для всех узлов.

1. В каждой VM (или контейнере) настройте статические IP-адреса.
2. Пример для VM:
   - Откройте файл `/etc/network/interfaces` внутри VM и настройте статический IP:
     ```bash
     auto eth0
     iface eth0 inet static
         address 10.0.0.2
         netmask 255.255.255.0
         gateway 10.0.0.1
     ```
